<!doctype html><html lang=en-us><head><title>The Digital Evidence Preservation Toolkit</title>
<link rel=icon type=image/png href=/images/favicon.png><link href="https://fonts.googleapis.com/css?family=Roboto:400,600,700" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet type=text/css href=/css/style.min.973539e55bb9a3b263afa3bea3a5c42c6bc9388ce23c69a67bf0e629f1a941a0.css integrity="sha256-lzU55Vu5o7Jjr6O+o6XELGvJOIziPGmme/DmKfGpQaA="><link rel=stylesheet type=text/css href=/css/icons.css><link rel=stylesheet href=/custom.css integrity media=screen></head><body><nav class="navbar is-fresh is-transparent no-shadow" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href=https://digitalevidencetoolkit.org/ label=logo><img src=/images/logo.svg alt width=112 height=28 alt=logo></a></div><div id=navbar-menu class="navbar-menu is-static"><div class=navbar-end></div></div></div></nav><nav id=navbar-clone class="navbar is-fresh is-transparent" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class=navbar-item href><img src=/images/logo.svg alt width=112 height=28>
</a><a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=cloned-navbar-menu><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div id=cloned-navbar-menu class="navbar-menu is-fixed"><div class=navbar-end></div></div></div></nav><section class="section is-medium"><div class=container><div class="columns is-centered"><div class="column is-9"><h1 class="title section-title">Technical Journal</h1><h5 class="subtitle is-5 is-muted"></h5><div class=divider></div></div></div><div class=content><div class="columns is-centered"><div class="column is-8" style=margin-top:2.5rem><p>Welcome to the documentation of the Digital Evidence Preservation Toolkit, a one-click tool to archive and annotate webpages while demonstrating chain of custody throughout. The Toolkit is a proof-of-concept software for researchers and small teams sifting through online material.</p><p>With only one click of the mouse, the material will be <strong>archived in a framework demonstrating chain of custody</strong> and <strong>stored durably</strong>. Once included in the growing database, users will be able to <strong>go back to search through</strong> and <strong>annotate the material</strong>, and to <strong>export working copies</strong> of said material for publication and dissemination.</p><p>A database built thusly can be handed to a prosecutor ten years down the line, and they will be able to say with mathematical certainty: <strong>‚Äúthe material in this archive is identical and contemporary to the one saved at the time, ten years ago.‚Äù</strong></p><hr><h1 id=the-flow-from-30000ft><strong>The flow from 30,000ft:</strong></h1><p>A <strong>browser extension</strong> is tasked with passing data from the user to the system.
The system receives this data through HTTP requests and <strong>records it into the ledger.
A GUI of the library</strong> is served by the system, and this can also add data to the ledger. <strong>Annotations</strong> can be added to the archive through the UI. <strong>Working copies,</strong> true to the originals, can be exported through the UI.</p><hr><h1 id=-what-is-where>ü§î What is where?</h1><p><strong>The browser extension</strong> is currently written in <strong>plain JS</strong> (as well as some HTML/CSS). The JS assets are bundled and moved in place by Webpack, which also provides auto-reloading of the extension in-browser.</p><p><strong>The app and API</strong> are currently written in (mostly) <strong>Node & TypeScript</strong>. It presently exposes REST endpoints (such as <code>/list-docs</code>, <code>/form</code>, etc.) and handles the interfacing with QLDB.</p><p>An <strong>example UI</strong> is included and built in <strong>Svelte</strong>, an amazing frontend framework. It demonstrates how some of the above API endpoints can be implemented and some of the capabilities of the tool.</p><p>All the above runs with <code>docker-compose</code>, as well as standalone <code>npm</code> scripts.</p><hr><h1 id=-so-where-are-we-today>ü•± So, where are we ${today}?</h1><h2 id=the-api>The API</h2><p>Both the browser extension and the app/API are in a functioning state, though features need to be developed in sync to be considered complete.</p><p>Among other things, the browser extension is able to POST an object of the following shape to the API endpoint <code>/form</code> (ed: this name is terrible):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>{ <span style=color:#a6e22e>url</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>scr</span>: <span style=color:#66d9ef>Base64DataURI</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>one_file</span>: <span style=color:#66d9ef>HTMLCodeString</span> }
</span></span></code></pre></div><p>We&rsquo;re including:</p><ul><li><strong>a base64-encoded screenshot PNG</strong> which, disappointingly, is only the visible part of the screen (see <a href=https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/Tabs/captureVisibleTab><code>browser.tabs.captureVisibleTab</code></a>).
Moving to a full-page screenshot will involve some fiddling with simulating a scroll while capturing with Screen Capture API, I&rsquo;m told.
These screenshots can be quite large (from a few hundred kbs to a couple of mbs) so on the app/API side we account for a chunked, streamed payload. All data from the browser is grouped in a <code>FormData()</code>.</li><li><strong>a long string of HTML code</strong> which contains all HTML, inlined styles and JavaScript, as well as encoded images where possible.
This is most definitely not quite <code>.mhtml</code>, which apparently is not supported on Firefox anymore since Quantum. Go figure!</li></ul><hr><p>A main <code>Record</code> type is defined as the central data structure flowing through the application.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Record</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// list of files preserved and hashed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// type Bundle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>bundle</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    { <span style=color:#a6e22e>typ</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;screenshot&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;one_file&#39;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#39;screenshot_thumbnail&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>hash</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;aaaaaaa&#39;</span>
</span></span><span style=display:flex><span>    }, {...}
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// user-created data about the record
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// most probably after the original archive
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// type Annotations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>annotations</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;description&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>other_key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;other val&#39;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// data points about the page saved
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// type Data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;page title&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://foo.bar.com&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Examples of this data flowing:</strong></p><ul><li>Upon receiving <code>POST /form</code> , the API wrangles the payload data into this shape, which can then be passed to <code>Ledger.insertDoc</code> to be added to the ledger.
(this includes side effects such as the writing to disk of screenshots and of the one-file archive)</li><li>The frontend consumes the result of <code>GET /list-docs</code>, which still fetches data from QLDB after passing it through two successive formatting functions:<ul><li><code>Record.fromLedger</code>, which takes QLDB-shaped data and builds a nice <code>Record</code> as defined above,</li><li>then <code>Record.toFrontend</code> , which takes a <code>Record</code> and builds a simplified shape for the frontend.</li></ul></li></ul><p><strong>Central to this type definition is the <em>Bundle:</em></strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Bundle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>File</span>.<span style=color:#a6e22e>File</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>File</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>kind</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;screenshot&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;one_file&#34;</span> <span style=color:#f92672>|</span> <span style=color:#e6db74>&#34;screenshot_thumbnail&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hash</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;xxx&#34;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>A Bundle is a list of files, which can only be of some kinds. At the back of our mind, these are the three kinds of files we&rsquo;re interested in for now:</p><ul><li>a page screenshot,</li><li>and its thumbnail for rendering in the UI,</li><li>as well as a one-file download of all the HTML/CSS/JS assets</li></ul><p>The QLDB logic can be found under the <code>QLDB.*</code> namespace.</p><h2 id=the-ui>The UI</h2><p>The webapp uses <a href=https://kit.svelte.dev>SvelteKit</a>, a JS framework. It implements two notables routes ‚Äì the two main use stories:</p><ul><li>The Library:¬†<code>src/routes/library.svelte</code></li><li>The Verification:¬†<code>src/routes/verify.svelte</code></li></ul><p><strong>Library</strong> renders a list of ledger entries, with their accompanying metadata. It supports the querying of a record&rsquo;s history, as well as the addition of metadata (i.e. a &ldquo;description&rdquo; field).</p><ul><li>details about how each of these features is replicated through the API</li></ul><p><strong>Verification</strong> implements the lookup process and surfacing of information made possible by the tool.</p><hr><h1 id=miscellaneous>Miscellaneous</h1><h3 id=on-uniqueness>On uniqueness</h3><p>Each record in our database contains a list of files that make it up (as of Aug 10th: a screenshot, its thumbnail, and a one-file HTML archive). Each is represented by its <em>kind</em> and its hash (sha256).</p><p>The ID of the record is the hash of the concatenated hashes of its files:</p><p><code>Record.id = hash(Record.files.sort().map(File.id).join(''))</code></p><p>With self-identifiable data, it is possible to associate files to their ledger entries, since the ID can be computed from the files.</p><h3 id=on-ledgers>On ledgers</h3><p>&ldquo;A non ledger database is table-centric. A ledger database is log-centric. <strong>The log is the database.</strong>&rdquo; (<a href=https://ivan.mw/2019-11-24/what-is-a-ledger-database>Ivan Moto</a>)</p><p>&ldquo;Standard databases track a sequence of transactions that add, delete, or change entries. Ledger databases add a layer of digital signatures for each transaction so anyone can audit the list and see that it was constructed correctly. More importantly, no one has gone back to adjust a previous transaction ‚Äî to change history, so to speak.&rdquo; (<a href=https://venturebeat.com/2021/01/18/database-trends-why-you-need-a-ledger-database/>VentureBeat</a>)</p><hr><button class="button is-info is-outlined">
<a href=https://digitalevidencetoolkit.org/><span class=icon><i class="fa fa-arrow-left"></i>
</span><span>Home</span></a></button></div></div></div></div></section><footer class="footer footer-dark"><div class=container><div class=columns><div class=column><div class=footer-column><div class=footer-header><h3>Docs</h3></div><ul class=link-list><li><a href=/about>Contact and About us</a></li><li><a href=/getting-started>Get started</a></li><li><a href=/docs>Technical documentation</a></li><li><a href=https://github.com/orgs/digitalevidencetoolkit/projects/3>Roadmap</a></li><li><a href=https://github.com/digitalevidencetoolkit/deptoolkit/releases>Changelog</a></li></ul></div></div><div class=column><div class=footer-column><div class=footer-header><h3>Follow Us</h3></div><nav class="level is-mobile"><div class=level-left><a class=level-item href=https://github.com/digitalevidencetoolkit><span class=icon><i class="fa fa-github fa-2x"></i></span>
</a><a class=level-item href=https://twitter.com/deptoolkit><span class=icon><i class="fa fa-twitter fa-2x"></i></span></a></div></nav><div class=footer-header><h3>Thanks to the support of</h3></div><div class=column><img src=/images/logo-bmbf.svg alt="Made with Bulma" width=128>
<img src=/images/logo-okfn.svg alt="Made with Bulma" width=128></div></div></div></div></div></footer><script src=https://unpkg.com/feather-icons></script></body></html>